(function(e,o){window.geolocationLoadMapAPI=function(){};var t,i,a=false,n=null,l,s,c,r,d,f=window.navigator.geolocation!==undefined,u=null,h=null,p=false,g=false,v=geolocationI18N,m=function(){if(!o){return}if(g){return}g=true;o.load("maps","3",{"other_params":geolocationI18N.api_key,"callback":"geolocationLoadMapAPI"})},w={"init":function(e){var t=this;if(!a){a=true;w.buildPanel.call(this);this.on("click",function(e){e.preventDefault();w.toggle.call(t)})}if(e&&e.location){w.setLocation.call(t,e.location);if(w.hasExistingLocation.call(t)){m()}}if(!o){setTimeout(function(){t.trigger("locationDisabled")},1)}return this},"toggle":function(){if(p){w.close.call(this)}else{w.open.call(this)}},"buildPanel":function(){var o=this;n=e('<div class="geolocation-panel-container"></div>').addClass("geolocation-panel");l=e('<span><a class="button disabled" href="#locate">Locate</a><span class="geolocation-search-input"><input id=\'geolocation-search-input\' type="text" placeholder=\'Address\' /><label for=\'geolocation-search-input\'>Current Location</label></span></span>').addClass("geolocation-search-field").appendTo(n);l.find("label").text(v.current_location);l.find("a").text(v.locate);l.find("input").attr("placeholder",v.address);s=e('<span><span class="spinner"></span><span class="progress-message">Locating</span></span>').addClass("geolocation-progress-field").appendTo(n).hide();s.find(".progress-message").text(v.locating);r=e('<span><a class="button" href="#search">Search</a><a class="button-primary" href="#use">Use</a><span></span></span>').addClass("geolocation-dialog-field").appendTo(n).hide();r.find('[href="#search"]').text(v.search);r.find('[href="#use"]').text(v.use);c=e("<span>Location, US</span>").addClass("geolocation-location-field").appendTo(n).hide();d=e('<span><a class="button" href="#search">Back</a><span>Location not found.</span></span>').addClass("geolocation-error-field").appendTo(n).hide();d.find("a").text(v.text);d.find("span").text(v.error);if(f){l.find("a").removeClass("disabled");l.find("input").attr("placeholder","")}else{l.find("label").hide()}},"open":function(){m();var o=this;p=true;n.insertAfter("#wp-content-media-buttons");w.position.call(this,n);setTimeout(function(){e(document.body).on("click.geolocationPicker",function(t){if(!e(t.target).parents().andSelf().is(e(n,o))){t.preventDefault();w.close.call(o)}})},1);e(window).one("resize",function(){w.close.call(o)});n.on("keyup.geolocationPicker","input",function(e){var o=l.find("input").val();disable=!f&&o==="";l.find("a").toggleClass("disabled",disable);if(!f){return}l.find("label")[o===""?"show":"hide"]()});n.on("keydown.geolocationPicker","input",function(e){if(e.which==13){e.preventDefault();l.find("a").trigger("click.geolocationPicker")}else if(e.which==27){e.preventDefault();w.close.call(o)}});n.on("click.geolocationPicker",'[href="#locate"]',function(e){e.preventDefault();if(l.find("a").hasClass("disabled")){return}o.trigger("locating");var t=l.find("input").val();if(t===""&&f){w.locate.call(o)}else{w.geocode.call(o,{"address":l.find("input").val()})}});n.on("click.geolocationPicker",'[href="#use"]',function(e){e.preventDefault();if(w.hasLocation()){o.trigger("locationPicked",[i])}else{o.trigger("locationRemoved")}});n.on("click.geolocationPicker",'[href="#search"]',function(e){e.preventDefault();w.removeMap.call(o);l.show();c.hide();r.hide();s.hide();d.hide()});this.on("locating.geolocationPicker",function(){l.hide();c.hide();r.hide();d.hide();s.show();d.hide()});this.on("located.geolocationPicker",function(e,t,i){c.show();r.show();l.hide();d.hide();s.hide();w.displayLocation.call(o,t,i)});this.on("locationRemoved.geolocationPicker",function(){c.hide();r.hide();l.show();s.hide();d.hide();w.clearLocation.call(o);w.close.call(o)});this.on("locationPicked.geolocationPicker",function(e,t){w.setLocation.call(o,t);w.close.call(o)});this.on("locationError.geolocationPicker",function(e){c.hide();r.hide();l.hide();s.hide();d.show()});if(w.hasExistingLocation.call(o)){this.trigger("located",t)}l.find("input").focus()},"close":function(){e(document.body).off("click.geolocationPicker");n.remove();w.removeMap.call(this);n.off(".geolocationPicker");this.off(".geolocationPicker");p=false},"position":function(o){var t=this.position();if(e(window).width()>=780){o.css({"position":"absolute","top":t.top-10,"left":t.left+this.outerWidth(),"z-index":1e3,"width":"320"}).removeClass("inline");var i=o.offset().left+o.outerWidth(),a=e(window).width()-10;if(i>a){o.css({"left":o.position().left+a-i})}}else{o.css({"position":"relative","width":"auto","left":0,"top":0}).addClass("inline")}},"hasExistingLocation":function(){if(!t){return false}var e=t.latitude&&t.longitude;return e},"hasLocation":function(){var e=i&&i.latitude&&i.longitude;if(!e){return false}if(e&&!i.address){i.address=i.latitude+", "+i.longitude}return true},"setLocation":function(e){var o=e&&e.latitude&&e.longitude;if(o&&!e.address){e.address=e.latitude+", "+e.longitude}if(o){t=e;i=null;this.text(e.address).attr("title",e.address).addClass("located")}},"clearLocation":function(){t=null;r.find('[href="#use"]').text("Use");this.text("Add Location").attr("title",null).removeClass("located");w.removeMap.call(this)},"removeMap":function(){if(u){e(u.getDiv()).remove();u=null}},"locate":function(){var t=this,i=e.proxy(function(e){var t=new o.maps.LatLng(e.coords.latitude,e.coords.longitude);w.geocode.call(this,{"latLng":t})},this),a=e.proxy(function(){t.trigger("locationError")},this);window.navigator.geolocation.getCurrentPosition(i,a,{timeout:5e3})},"geocode":function(t){var a=this,n=new o.maps.Geocoder;n.geocode(t,function(n,l){if(l==o.maps.GeocoderStatus.OK){var s=false,c,r=t.latLng;for(var d=0;d<n.length;d++){c=n[d];s=r?e.inArray("political",c.types)>-1:true;if(s){name=c.formatted_address;if(r){i={latitude:t.latLng.lat(),longitude:t.latLng.lng()}}else{i={latitude:c.geometry.location.lat(),longitude:c.geometry.location.lng()}}i.result=c;i.address=name;break}}if(s)a.trigger("located",[i,c])}else{a.trigger("locationError")}})},"displayLocation":function(t,i){var a=new o.maps.LatLng(t.latitude,t.longitude);if(w.hasLocation.call(this)){r.find('[href="#use"]').text("Use")}else if(w.hasExistingLocation.call(this)){r.find('[href="#use"]').text("Remove")}c.text(t.address);if(u===null){var l=e("<div></div>").addClass("geolocation-map-container").css({"width":n.width(),"height":Math.min(240,n.width())}).insertBefore(c);u=new o.maps.Map(l.get(0),{center:i?i.geometry.location:a,zoom:9,draggable:false,streetViewControl:false,zoomControl:true,mapTypeControl:false,overviewMapControl:false,panControl:true,rotateControl:false,scaleControl:false})}if(h){h.setMap(null)}h=new o.maps.Marker({map:u,position:a});if(i){u.fitBounds(i.geometry.viewport)}else{u.setCenter(a)}}};e.fn.geolocationPicker=function(){var o=[].slice.apply(arguments),t=e.type(o[0])==="string"?o.shift():"init",i=w[t]||function(){throw"Method "+i+" does not exist for geolocationPicker"};return i.apply(this,o)}})(jQuery,window.google);